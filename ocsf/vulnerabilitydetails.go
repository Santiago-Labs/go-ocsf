package ocsf

import (
	"time"

	"github.com/apache/arrow/go/v15/arrow"
)

// VulnerabilityDetailsFields defines the Arrow fields for VulnerabilityDetails.
var VulnerabilityDetailsFields = []arrow.Field{
	{Name: "uid", Type: arrow.BinaryTypes.String},
	{Name: "cve", Type: CVEStruct},
	{Name: "cwe", Type: CWEStruct},
	{Name: "desc", Type: arrow.BinaryTypes.String},
	{Name: "title", Type: arrow.BinaryTypes.String},
	{Name: "severity", Type: arrow.BinaryTypes.String},
	{Name: "is_exploit_available", Type: arrow.FixedWidthTypes.Boolean},
	{Name: "first_seen_time", Type: arrow.BinaryTypes.String},
	{Name: "is_fix_available", Type: arrow.FixedWidthTypes.Boolean},
	{Name: "kb_article_list", Type: arrow.ListOf(KBArticleStruct)},
	{Name: "last_seen_time", Type: arrow.BinaryTypes.String},
	{Name: "references", Type: arrow.ListOf(arrow.BinaryTypes.String)},
	{Name: "related_vulnerabilities", Type: arrow.ListOf(arrow.BinaryTypes.String)},
	{Name: "remediation", Type: RemediationStruct},
	{Name: "vendor_name", Type: arrow.BinaryTypes.String},
	{Name: "affected_code", Type: arrow.ListOf(AffectedCodeStruct)},
	{Name: "affected_packages", Type: arrow.ListOf(AffectedSoftwarePackageStruct)},
}

var VulnerabilityDetailsStruct = arrow.StructOf(VulnerabilityDetailsFields...)

type VulnerabilityDetails struct {
	UID                    *string                   `json:"uid" parquet:"uid"`
	CVE                    *CVE                      `json:"cve" parquet:"cve"`
	CWE                    *CWE                      `json:"cwe" parquet:"cwe"` // e.g. "CWE-79"
	Desc                   *string                   `json:"desc" parquet:"desc"`
	Title                  *string                   `json:"title" parquet:"title"`
	Severity               *string                   `json:"severity" parquet:"severity"`
	IsExploitAvailable     *bool                     `json:"is_exploit_available" parquet:"is_exploit_available"`
	FirstSeenTime          *time.Time                `json:"first_seen_time" parquet:"first_seen_time"` // ISO8601 timestamp
	IsFixAvailable         bool                      `json:"is_fix_available" parquet:"is_fix_available"`
	KbArticleList          []KBArticle               `json:"kb_article_list" parquet:"kb_article_list"`
	LastSeenTime           *time.Time                `json:"last_seen_time" parquet:"last_seen_time"` // ISO8601 timestamp
	References             []string                  `json:"references" parquet:"references"`
	RelatedVulnerabilities []string                  `json:"related_vulnerabilities" parquet:"related_vulnerabilities"`
	Remediation            *Remediation              `json:"remediation" parquet:"remediation"`
	VendorName             *string                   `json:"vendor_name" parquet:"vendor_name"`
	AffectedCode           []AffectedCode            `json:"affected_code,omitempty" parquet:"affected_code"`
	AffectedPackages       []AffectedSoftwarePackage `json:"affected_packages,omitempty" parquet:"affected_packages"`
}
